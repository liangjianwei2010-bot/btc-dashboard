<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Bitcoin Dashboard</title>
  <meta name="description" content="Personal Bitcoin status & risk dashboard." />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <style>
    :root{
      --bg: #0f1115; --card:#171a21; --text:#e6e6e6; --muted:#9aa0a6; --accent:#4da3ff; --good:#27ae60; --warn:#f1c40f; --bad:#e74c3c;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#ffffff; --card:#f6f8fb; --text:#1b1f24; --muted:#5f6368; --accent:#1565c0; --good:#1e7d4f; --warn:#a17900; --bad:#b3392d; }
    }
    *{ box-sizing: border-box }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    header{
      padding: 20px 16px; border-bottom: 1px solid rgba(255,255,255,0.06);
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .brand{ font-weight:700; letter-spacing:0.2px }
    .grid{ display:grid; gap:16px; padding:16px; grid-template-columns: 1fr; max-width: 1200px; margin:0 auto; }
    @media (min-width: 900px){ .grid{ grid-template-columns: repeat(12, 1fr) } }
    .card{
      background:var(--card); border:1px solid rgba(0,0,0,0.2); border-radius:14px; padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .span-4{ grid-column: span 4 }
    .span-6{ grid-column: span 6 }
    .span-8{ grid-column: span 8 }
    .span-12{ grid-column: span 12 }
    .kpis{ display:flex; gap:16px; flex-wrap:wrap }
    .kpi{ flex:1 1 160px; background: rgba(255,255,255,0.03); border-radius:12px; padding:12px 14px }
    .kpi h3{ margin:0 0 6px 0; font-size:13px; color:var(--muted); font-weight:600; letter-spacing:0.3px }
    .kpi .val{ font-size:22px; font-weight:700 }
    .chg.up{ color: var(--good) } .chg.down{ color: var(--bad) }
    .risk-pill{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-weight:700; letter-spacing:0.3px
    }
    .risk-low{ background:rgba(39,174,96,0.15); color:var(--good); border:1px solid rgba(39,174,96,0.35) }
    .risk-medium{ background:rgba(241,196,15,0.15); color:var(--warn); border:1px solid rgba(241,196,15,0.35) }
    .risk-high{ background:rgba(231,76,60,0.15); color:var(--bad); border:1px solid rgba(231,76,60,0.35) }
    .muted{ color: var(--muted) }
    footer{ padding: 24px 16px; text-align:center; color: var(--muted) }
    a{ color: var(--accent); text-decoration: none }
    .small{ font-size: 12px }
    canvas{ width:100%; height:300px }
  </style>
</head>
<body>
  <header>
    <div class="brand">Mick — Bitcoin Status</div>
    <div class="muted small" id="updated">Loading…</div>
  </header>

  <main class="grid">
    <!-- KPIs -->
    <section class="card span-12">
      <div class="kpis">
        <div class="kpi">
          <h3>BTC Price (USDT)</h3>
          <div class="val" id="price">—</div>
          <div id="priceChange" class="small muted">—</div>
        </div>
        <div class="kpi">
          <h3>Fear & Greed (now)</h3>
          <div class="val" id="fgi">—</div>
          <div class="small muted" id="fgiLabel">—</div>
        </div>
        <div class="kpi">
          <h3>Risk Level</h3>
          <div class="val"><span id="riskPill" class="risk-pill">—</span></div>
          <div class="small muted" id="riskNote">Based on F&G + 24h change</div>
        </div>
      </div>
    </section>

    <!-- Fear & Greed chart -->
    <section class="card span-6">
      <h3 style="margin-top:0">Fear & Greed — last 30 days</h3>
      <canvas id="fgiChart"></canvas>
      <div class="small muted">Source: Alternative.me</div>
    </section>

    <!-- BTC Dominance chart (TradingView) -->
    <section class="card span-6">
      <h3 style="margin-top:0">Bitcoin Dominance (BTC.D)</h3>
      <div id="tv-widget"></div>
      <div class="small muted">Source: TradingView</div>
    </section>

    <!-- Notes -->
    <section class="card span-12">
      <h3 style="margin-top:0">How risk is computed</h3>
      <p class="small muted">
        Risk is a simple heuristic: F&G (0–100) + scaled absolute 24h % change. It’s for your personal use only, not financial advice.
      </p>
      <ul class="small">
        <li><b>Low</b>: composite &lt; 40</li>
        <li><b>Medium</b>: 40–65</li>
        <li><b>High</b>: &gt; 65</li>
      </ul>
    </section>
  </main>

  <footer>
    Built for personal use • Data: Binance, Alternative.me, TradingView
  </footer>

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>


  <script>
    const els = {
      updated: document.getElementById('updated'),
      price: document.getElementById('price'),
      priceChange: document.getElementById('priceChange'),
      fgi: document.getElementById('fgi'),
      fgiLabel: document.getElementById('fgiLabel'),
      riskPill: document.getElementById('riskPill'),
      riskNote: document.getElementById('riskNote'),
    };

    function fmtUSD(n){
      return Number(n).toLocaleString(undefined, { style:'currency', currency:'USD', maximumFractionDigits: 2 });
    }

    function setRisk(composite){
      let level, cls;
      if (composite < 40){ level = "LOW"; cls = "risk-low"; }
      else if (composite <= 65){ level = "MEDIUM"; cls = "risk-medium"; }
      else { level = "HIGH"; cls = "risk-high"; }
      els.riskPill.className = "risk-pill " + cls;
      els.riskPill.textContent = `${level} (${Math.round(composite)})`;
    }

    async function fetchBinance(){
      // 24hr ticker for BTCUSDT (no API key required)
      const r = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT');
      if (!r.ok) throw new Error('Binance API error');
      const j = await r.json();
      const last = j.lastPrice;
      const chgPct = parseFloat(j.priceChangePercent);
      els.price.textContent = fmtUSD(last);
      const chgEl = els.priceChange;
      chgEl.textContent = `${chgPct.toFixed(2)}% (24h)`;
      chgEl.className = 'small ' + (chgPct >= 0 ? 'chg up' : 'chg down');
      return { last: parseFloat(last), chgPct };
    }

    async function fetchFearGreed(limit=30){
      // Alternative.me Fear & Greed API (public)
      // docs: https://api.alternative.me/fng/
      const r = await fetch(`https://api.alternative.me/fng/?limit=${limit}&format=json`);
      if (!r.ok) throw new Error('F&G API error');
      const { data } = await r.json();
      // data array is newest first
      const cur = data[0];
      els.fgi.textContent = cur.value;
      els.fgiLabel.textContent = cur.value_classification;
      // build chart data (reverse to oldest->newest)
      const points = data.slice().reverse().map(d => ({
        t: new Date(parseInt(d.timestamp,10)*1000),
        v: parseInt(d.value,10)
      }));
      return { current: parseInt(cur.value,10), label: cur.value_classification, series: points };
    }

    function drawFgiChart(points){
      const ctx = document.getElementById('fgiChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: points.map(p => p.t.toLocaleDateString()),
          datasets: [{
            label: 'Fear & Greed',
            data: points.map(p => p.v),
            tension: 0.3,
            fill: false
          }]
        },
        options: {
          responsive:true,
          scales: {
            y: { beginAtZero:true, suggestedMax:100, title:{ display:true, text:'Index (0-100)' } }
          },
          plugins: {
            legend: { display:false },
            tooltip: { mode: 'index', intersect: false }
          }
        }
      });
    }

    function mountTradingView(){
      // Lightweight TradingView Widget for BTC Dominance
      const s = document.createElement('script');
      s.src = "https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js";
      s.async = true;
      s.innerHTML = JSON.stringify({
        autosize: true,
        symbol: "CRYPTOCAP:BTC.D",
        interval: "D",
        timezone: "Europe/Stockholm",
        theme: (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? "dark" : "light",
        style: "1",
        locale: "en",
        hide_top_toolbar: false,
        hide_legend: false,
        allow_symbol_change: false,
        studies: [],
        backgroundColor: "transparent",
      });
      const wrap = document.createElement('div');
      wrap.className = "tradingview-widget-container";
      const cont = document.createElement('div');
      cont.className = "tradingview-widget-container__widget";
      wrap.appendChild(cont);
      wrap.appendChild(s);
      document.getElementById('tv-widget').appendChild(wrap);
    }

    function computeRisk(fgi, chgPct){
      // Simple composite: 70% weight to FGI, 30% to magnitude of 24h % change scaled to 0-100 by clamping at 10%
      const volComponent = Math.min(Math.abs(chgPct), 10) * 10; // 0–100
      return 0.7 * fgi + 0.3 * volComponent;
    }

<script>
  async function init(){
    try{
      const [bin, fgi] = await Promise.all([fetchBinance(), fetchFearGreed(30)]);

      // Compute risk first so a chart issue can't block it
      const composite = computeRisk(fgi.current, bin.chgPct);
      setRisk(composite);

      // Mount TradingView regardless of chart status
      try { mountTradingView(); } catch(e){ console.warn('TV widget failed', e); }

      // Draw F&G chart only if Chart.js loaded
      try {
        if (window.Chart) {
          drawFgiChart(fgi.series);
        } else {
          console.warn('Chart.js not available; skipping chart');
        }
      } catch (e) {
        console.warn('Failed to draw chart', e);
      }

      els.updated.textContent = "Updated: " + new Date().toLocaleString();
    }catch(err){
      console.error(err);
      els.updated.textContent = "Some data failed to load. Try refresh.";
      // Still try TradingView even if other data failed
      try { mountTradingView(); } catch(e){}
    }
  }
  init();
</script>

  </script>
</body>
</html>

